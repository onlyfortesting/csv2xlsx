name: Build Workflow

on:
  push:
    branches: [release]

jobs:
  build:
    runs-on: windows-latest

    steps:
      # Check-out repository
      - uses: actions/checkout@v4

        # Setup Python
      - uses: actions/setup-python@v5
        with:
          python-version: "3.x" # Version range or exact version of a Python version to use, using SemVer's version range syntax
          architecture: "x64" # optional x64 or x86. Defaults to x64 if not specified

        # Build python script into a single execute or app folder (macOS)
      - uses: Nuitka/Nuitka-Action@v1.1
        with:
          nuitka-version: main
          script-name: main.py
          # mode: app
          # standalone: true
          onefile: true
          follow-imports: true
          # include-module: |
          #   pandas
          #   tkinter
          #   os
          #   pathlib
          enable-plugins: |
            tk-inter
            numpy

        # Uploads artifacts
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ runner.os }} Build
          path: |
            build/main.dist/main.exe
          include-hidden-files: true

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.event.head_commit.message }}
          release_name: ${{ github.event.head_commit.message }}
          draft: false
          prerelease: false

      - name: Upload Release Asset
        id: upload-release-asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{steps.create_release.outputs.upload_url}}
          asset_path: build/main.dist/main.exe
          asset_name: csv2xlsx-x64.exe
